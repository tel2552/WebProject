<!DOCTYPE html>
<html lang="en">
<style>
    body {
        background-image: url("/static/IMG_4022.jpg");
        background-color: #cccccc;
        background-position: center;
        background-repeat: no-repeat;
        -moz-background-size: 100% 100%;
        -webkit-background-size: 100% 100%;
        background-size: 100% 100%;
    }

    /* Style for the modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 600px;
        border-radius: 5px;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    #termsCheckbox {
        display: flex; /* ใช้ Flexbox เพื่อจัดเรียง checkbox และข้อความในแนวเดียวกัน */
        align-items: center; /* จัดให้อยู่ตรงกลางแนวตั้ง */
        text-align: left;
        gap: 8px; /* เพิ่มระยะห่างระหว่าง checkbox กับข้อความ */
    }

    #termsAgree {
        width: 16px;
        height: 16px;
        margin: 0;
    }

    #agreeBtn {
        margin-top: 10px;
        background-color: #4CAF50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        opacity: 0.5; /* Initially set to disabled style */
        pointer-events: none; /* Initially disable clicking */
    }

    #agreeBtn.enabled {
        opacity: 1; /* Change to enabled style */
        pointer-events: auto; /* Enable clicking */
    }

    #cancelBtn {
        margin-top: 10px;
        background-color: #f44336;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
</style>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เข้าสู่ระบบ</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="container">
        <h1>Login</h1>
        <form id="login-form" method="post">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>

            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>

            <button type="submit">Login</button>
        </form>
        <p>ยังไม่มีบัญชี? <a href="/register">สมัครสมาชิก</a></p>
    </div>

    <!-- The Modal -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ข้อกำหนดและเงื่อนไข</h2>
            <p>กรุณาอ่านข้อกำหนดและเงื่อนไขทั้งหมดก่อนดำเนินการต่อ</p>
            <p>....</p>
            <label id="termsCheckbox">
                <input type="checkbox" id="termsAgree">
                <span>ฉันได้อ่านและยอมรับข้อกำหนดและเงื่อนไขทั้งหมด</span>
            </label>
            <div>
                <button id="agreeBtn" disabled>ตกลง</button>
                <button id="cancelBtn">ยกเลิก</button>
            </div>
        </div>
    </div>

    <script>
        // Get the modal
        var modal = document.getElementById("termsModal");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // Get the checkbox, agree button, and cancel button
        var termsCheckbox = document.getElementById("termsAgree");
        var agreeBtn = document.getElementById("agreeBtn");
        var cancelBtn = document.getElementById("cancelBtn");

        // When the user clicks the button, open the modal
        window.onload = function () {
            modal.style.display = "block";
        };

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }
        // Function to handle redirection
        function redirectToExternalSite() {
            window.location.href = "https://www.google.com/"; // Replace with your desired URL
        }

        // If the user clicks cancel.
        cancelBtn.onclick = function () {
            modal.style.display = "none";
            redirectToExternalSite()
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
                redirectToExternalSite()
            }
        }

        // Checkbox event listener to enable/disable the agree button
        termsCheckbox.addEventListener("change", function () {
            if (this.checked) {
                agreeBtn.classList.add("enabled");
                agreeBtn.disabled = false;
            } else {
                agreeBtn.classList.remove("enabled");
                agreeBtn.disabled = true;
            }
        });

        agreeBtn.onclick = function () {
            modal.style.display = "none";
        }

        document.getElementById("login-form").addEventListener("submit", async (event) => {
            event.preventDefault();

            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            const formData = new URLSearchParams();
            formData.append("username", username);
            formData.append("password", password);

            const response = await fetch("/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: formData.toString()
            });
            const result = await response.json();
            if (response.ok) {
                localStorage.setItem("access_token", result.token);
                window.location.href = result.redirect_url; // Redirect to the new URL
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาด!',
                    text: "ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง",
                    confirmButtonText: 'ตกลง',
                });
            }
        });
    </script>
</body>

</html>
